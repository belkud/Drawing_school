<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Курс по акварели | Петербург сквозь года</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">

  <!-- Ваши стили -->
  <link rel="stylesheet" href="/css/style.css">

  <!-- jQuery и Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
  <div id="app">
    <div id="header"></div>
    <div id="about_course"></div>
    <div id="materials"></div>
    <div id="tariffs"></div>
    <div id="faq"></div>
    <div id="footer"></div>
  </div>
<script>
  // ТЕСТ: Проверяем правильный путь
    console.log('Текущий URL:', window.location.href);
    console.log('Пробуем загрузить компонент...');

    fetch('/Drawing_school/components/header.html')
      .then(response => {
        console.log('Статус /Drawing_school/components/header.html:', response.status);
        if (response.ok) {
          console.log('✓ Правильный путь! Используйте /Drawing_school/components/');
        } else {
          console.log('✗ Не работает, пробуем другой путь...');
          fetch('components/header.html')
            .then(r => console.log('Статус components/header.html:', r.status));
        }
      });


    $(document).ready(function () {

      const components = [
        { id: 'header', file: 'https://github.com/belkud/Drawing_school/blob/main/components/header.html' },
        { id: 'about_course', file: 'components/about_course.html' },
        { id: 'materials', file: 'components/materials.html' },
        { id: 'tariffs', file: 'components/tariffs.html' },
        { id: 'faq', file: 'components/faq.html' },
        { id: 'footer', file: 'components/footer.html' }
      ];

      let loadedCount = 0;

      components.forEach(component => {
        $(`#${component.id}`).load(component.file, function (response, status) {
          loadedCount++;

          if (status === "error") {
            console.error(`Ошибка загрузки ${component.file}`);
            $(`#${component.id}`).html(`<div class="alert alert-danger">Ошибка загрузки компонента</div>`);
          }

          // Когда все компоненты загружены
          if (loadedCount === components.length) {
            console.log('Все компоненты загружены');
            initApp();
          }
        });
      });


      function initApp() {
        // 1. Список материалов
        initMaterialsList();

        // 2. FAQ
        initFAQ();

        // 3. Валюты
        initCurrency();

        // 4. Навигация
        initNavigation();
      }

      function initMaterialsList() {
        const $container = $('#materialsContainer');
        const $list = $('.materials-list');
        const $toggleBtn = $('.toggle-list-btn');

        if ($toggleBtn.length) {
          $toggleBtn.on('click', function () {
            $list.slideToggle(300);
            $container.toggleClass('active');
          });

          $(document).on('click', function (e) {
            if (!$container.is(e.target) &&
              $container.has(e.target).length === 0 &&
              $list.is(':visible')) {
              $list.slideUp(300);
              $container.removeClass('active');
            }
          });
        }
      }

      function initFAQ() {
        $('.faq-question').on('click', function (e) {
          e.preventDefault();
          const $question = $(this);
          const $answer = $question.next('.faq-answer');
          $answer.slideToggle(300);
          $question.toggleClass('active');
        });
      }

      function initCurrency() {
        // Сохраняем оригинальные цены при загрузке
        $('.card').each(function () {
          const priceElement = $(this).find('.price-new');
          const originalText = priceElement.text().trim();
          $(this).data('original-price', originalText);
        });

        // Обработка кнопок валют
        $('.currency-btn').on('click', function () {
          const card = $(this).closest('.card');
          const priceElement = card.find('.price-new');
          const originalPrice = card.data('original-price');
          const isDollar = $(this).find('svg.bi-currency-dollar').length > 0;

          if (isDollar) {
            const priceInRubles = parseFloat(originalPrice.replace(/[^\d.]/g, ''));
            const priceInDollars = (priceInRubles / 70).toFixed(2);
            priceElement.text(`${priceInDollars} $`);
            card.find('.currency-btn').removeClass('active');
            $(this).addClass('active');
          } else {
            priceElement.text(originalPrice);
            card.find('.currency-btn').removeClass('active');
            $(this).addClass('active');
          }
        });
      }

      function initNavigation() {
        $('a.nav-link, .btn-warning').on('click', function (e) {
          if (this.hash !== '') {
            e.preventDefault();
            const hash = this.hash;
            $('html, body').animate({
              scrollTop: $(hash).offset().top - 70
            }, 800);
          }
        });

        $(window).on('scroll', function () {
          let scrollPos = $(document).scrollTop() + 100;
          $('a.nav-link').each(function () {
            let currLink = $(this);
            let refElement = $(currLink.attr('href'));
            if (refElement.length && refElement.position().top <= scrollPos && refElement.position().top + refElement.height() > scrollPos) {
              $('a.nav-link').removeClass('active font-weight-bold');
              currLink.addClass('active font-weight-bold');
            }
          });
        });
      }
    });
</script>
  <script type="module" src="/js/main.js"></script>
</body>

</html>